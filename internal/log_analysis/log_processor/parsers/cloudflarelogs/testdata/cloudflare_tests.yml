# Panther is a Cloud-Native SIEM for the Modern Security Team.
# Copyright (C) 2020 Panther Labs Inc
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as
# published by the Free Software Foundation, either version 3 of the
# License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <https://www.gnu.org/licenses/>.

name: firewall
logType: Cloudflare.Firewall
input: |
  {
      "Action": "firewall-action",
      "ClientASN": 123,
      "ClientASNDescription": "123",
      "ClientCountry": "Greece",
      "ClientIP": "128.127.128.127",
      "ClientIPClass": "clean",
      "ClientRefererHost": "example-referrer.com",
      "ClientRefererPath": "/ref-path",
      "ClientRefererQuery": "?query=param",
      "ClientRefererScheme": "https",
      "ClientRequestHost": "example.com",
      "ClientRequestMethod": "POST",
      "ClientRequestPath": "/",
      "ClientRequestProtocol": "HTTP 1.1",
      "ClientRequestQuery": "/",
      "ClientRequestScheme": "https",
      "ClientRequestUserAgent": "firefox",
      "Datetime": 1600365601,
      "EdgeColoCode": "IATA-123",
      "EdgeResponseStatus": 200,
      "Kind": "firewall",
      "MatchIndex": 1234,
      "Metadata": {
          "Metadata1": "metadata-1",
          "Metadata2": "metadata-2"
      },
      "OriginResponseStatus": 200,
      "OriginatorRayID": "originator-ray-id",
      "RayID": "ray-id",
      "RuleID": "rule-id",
      "Source": "cloudflare-security-product"
  }
result: |
  {
    "Action": "firewall-action",
    "ClientASN": 123,
    "ClientASNDescription": "123",
    "ClientCountry": "Greece",
    "ClientIP": "128.127.128.127",
    "ClientIPClass": "clean",
    "ClientRefererHost": "example-referrer.com",
    "ClientRefererPath": "/ref-path",
    "ClientRefererQuery": "?query=param",
    "ClientRefererScheme": "https",
    "ClientRequestHost": "example.com",
    "ClientRequestMethod": "POST",
    "ClientRequestPath": "/",
    "ClientRequestProtocol": "HTTP 1.1",
    "ClientRequestQuery": "/",
    "ClientRequestScheme": "https",
    "ClientRequestUserAgent": "firefox",
    "Datetime": "2020-09-17T18:00:01Z",
    "EdgeColoCode": "IATA-123",
    "EdgeResponseStatus": 200,
    "Kind": "firewall",
    "MatchIndex": 1234,
    "Metadata": {
        "Metadata1": "metadata-1",
        "Metadata2": "metadata-2"
    },
    "OriginResponseStatus": 200,
    "OriginatorRayID": "originator-ray-id",
    "RayID": "ray-id",
    "RuleID": "rule-id",
    "Source": "cloudflare-security-product",
    "p_log_type": "Cloudflare.Firewall",
    "p_event_time":"2020-09-17T18:00:01Z",
    "p_any_domain_names": ["example-referrer.com", "example.com"],
    "p_any_ip_addresses": ["128.127.128.127"],
    "p_any_trace_ids": ["originator-ray-id", "ray-id"]
  }

---
name: firewall required fields only
logType: Cloudflare.Firewall
input: |
  {
    "Datetime": "2020-09-17T18:00:00Z"
  }
result: |
  {
    "Datetime": "2020-09-17T18:00:00Z",
    "p_log_type": "Cloudflare.Firewall",
    "p_event_time":"2020-09-17T18:00:00Z"
  }
---
name: http_request
logType: Cloudflare.HttpRequest
input: |
  {
    "BotScore":10,
  	"BotScoreSrc":"Heuristics",
  	"CacheCacheStatus":"hit",
  	"CacheResponseBytes": 1024,
  	"CacheResponseStatus": 200,
  	"CacheTieredFill":true,
  	"ClientASN": 123,
  	"ClientCountry":"Greece",
  	"ClientDeviceType":"mobile",
  	"ClientIP": "127.0.0.1",
  	"ClientIPClass": "clean",
  	"ClientRequestBytes": 2048,
  	"ClientRequestHost": "example.com",
  	"ClientRequestMethod": "POST",
  	"ClientRequestPath": "/path",
  	"ClientRequestProtocol": "HTTP 1.1",
  	"ClientRequestReferer": "example.com",
  	"ClientRequestURI": "/",
  	"ClientRequestUserAgent": "firefox",
  	"ClientSSLProtocol": "TLS 1.3",
  	"ClientSrcPort": 12800,
  	"ClientXRequestedWith": "XMLHttpRequest",
  	"EdgeColoCode": "9F",
  	"EdgeColoID": 123,
  	"EdgeEndTimestamp": "2020-08-07T07:52:09Z",
  	"EdgePathingOp": "unknown",
  	"EdgePathingSrc": "unknown",
  	"EdgePathingStatus": "unknown",
  	"EdgeRateLimitAction":"",
  	"EdgeRateLimitID": "rule-id",
  	"EdgeRequestHost": "example-edge.com",
  	"EdgeResponseBytes":1024,
  	"EdgeResponseCompressionRatio": 0.3,
  	"EdgeResponseContentType": "application/json",
  	"EdgeResponseStatus":200,
  	"EdgeServerIP": "127.127.127.127",
  	"EdgeStartTimestamp": 1600365600,
  	"FirewallMatchesActions": ["jschallengeFailed", "jschallengeBypassed"],
  	"FirewallMatchesRuleIDs": ["rule1", "rule2"],
  	"FirewallMatchesSources": ["sanitycheck","protect"],
  	"OriginIP": "128.128.128.128",
  	"OriginResponseBytes":512,
  	"OriginResponseHTTPExpires": "Fri, 21 Oct 2016 07:28:00 GMT",
  	"OriginResponseHTTPLastModified": "Fri, 21 Oct 2016 07:28:00 GMT",
  	"OriginResponseStatus": 200,
  	"OriginResponseTime": 1000000,
  	"OriginSSLProtocol": "TLS 1.3",
  	"ParentRayID": "parent-ray-id",
  	"RayID": "ray-id",
  	"SecurityLevel": "high",
  	"WAFAction": "none",
  	"WAFFlags": "simulate (0x1) | null",
  	"WAFMatchedVar": "some-variable",
  	"WAFProfile": "low",
  	"WAFRuleID": "waf-rule-id",
  	"WAFRuleMessage": "waf-rule-message",
  	"WorkerCPUTime": 1000000,
  	"WorkerStatus": "OK",
  	"WorkerSubrequest": true,
  	"WorkerSubrequestCount": 10,
  	"ZoneID": 123
  }

result: |
  {
  	"BotScore":10,
  	"BotScoreSrc":"Heuristics",
  	"CacheCacheStatus":"hit",
  	"CacheResponseBytes": 1024,
  	"CacheResponseStatus": 200,
  	"CacheTieredFill":true,
  	"ClientASN": 123,
  	"ClientCountry":"Greece",
  	"ClientDeviceType":"mobile",
  	"ClientIP": "127.0.0.1",
  	"ClientIPClass": "clean",
  	"ClientRequestBytes": 2048,
  	"ClientRequestHost": "example.com",
  	"ClientRequestMethod": "POST",
  	"ClientRequestPath": "/path",
  	"ClientRequestProtocol": "HTTP 1.1",
  	"ClientRequestReferer": "example.com",
  	"ClientRequestURI": "/",
  	"ClientRequestUserAgent": "firefox",
  	"ClientSSLProtocol": "TLS 1.3",
  	"ClientSrcPort": 12800,
  	"ClientXRequestedWith": "XMLHttpRequest",
  	"EdgeColoCode": "9F",
  	"EdgeColoID": 123,
  	"EdgeEndTimestamp": "2020-08-07T07:52:09Z",
  	"EdgePathingOp": "unknown",
  	"EdgePathingSrc": "unknown",
  	"EdgePathingStatus": "unknown",
  	"EdgeRateLimitAction":"",
  	"EdgeRateLimitID": "rule-id",
  	"EdgeRequestHost": "example-edge.com",
  	"EdgeResponseBytes":1024,
  	"EdgeResponseCompressionRatio": 0.3,
  	"EdgeResponseContentType": "application/json",
  	"EdgeResponseStatus":200,
  	"EdgeServerIP": "127.127.127.127",
  	"EdgeStartTimestamp": "2020-09-17T18:00:00Z",
  	"FirewallMatchesActions": ["jschallengeFailed", "jschallengeBypassed"],
  	"FirewallMatchesRuleIDs": ["rule1", "rule2"],
  	"FirewallMatchesSources": ["sanitycheck","protect"],
  	"OriginIP": "128.128.128.128",
  	"OriginResponseBytes":512,
  	"OriginResponseHTTPExpires": "Fri, 21 Oct 2016 07:28:00 GMT",
  	"OriginResponseHTTPLastModified": "Fri, 21 Oct 2016 07:28:00 GMT",
  	"OriginResponseStatus": 200,
  	"OriginResponseTime": 1000000,
  	"OriginSSLProtocol": "TLS 1.3",
  	"ParentRayID": "parent-ray-id",
  	"RayID": "ray-id",
  	"SecurityLevel": "high",
  	"WAFAction": "none",
  	"WAFFlags": "simulate (0x1) | null",
  	"WAFMatchedVar": "some-variable",
  	"WAFProfile": "low",
  	"WAFRuleID": "waf-rule-id",
  	"WAFRuleMessage": "waf-rule-message",
  	"WorkerCPUTime": 1000000,
  	"WorkerStatus": "OK",
  	"WorkerSubrequest": true,
  	"WorkerSubrequestCount": 10,
  	"ZoneID": 123,

  	"p_log_type": "Cloudflare.HttpRequest",
  	"p_event_time":"2020-09-17T18:00:00Z",
  	"p_any_domain_names": ["example-edge.com", "example.com"],
  	"p_any_ip_addresses": ["127.0.0.1", "127.127.127.127", "128.128.128.128"],
  	"p_any_trace_ids": ["parent-ray-id", "ray-id"]
  }
---
name: httprequest required fields only
logType: Cloudflare.HttpRequest
input: |
  {
    "EdgeStartTimestamp": "2020-09-17T18:00:00Z"
  }
result: |
  {
    "EdgeStartTimestamp": "2020-09-17T18:00:00Z",
    "p_log_type": "Cloudflare.HttpRequest",
    "p_event_time":"2020-09-17T18:00:00Z"
  }

---
name: spectrum
logType: Cloudflare.Spectrum
input: |
  {
      "Application": "app-123",
      "ClientASN": 123,
      "ClientBytes": 1024,
      "ClientCountry": "Greece",
      "ClientIP": "127.127.127.127",
      "ClientMatchedIpFirewall": "ALLOW",
      "ClientPort": 1040,
      "ClientProto": "tcp",
      "ClientTcpRtt": 200000,
      "ClientTlsCipher": "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256",
      "ClientTlsClientHelloServerName": "hello-server-name",
      "ClientTlsProtocol": "TLS 1.3",
      "ClientTlsStatus": "OK",
      "ColoCode": "IATA-123",
      "ConnectTimestamp": "2020-08-07T07:52:09Z",
      "DisconnectTimestamp": "2020-08-07T07:52:09Z",
      "Event": "connect",
      "IpFirewall": true,
      "OriginBytes": 512,
      "OriginIP": "128.128.128.128",
      "OriginPort": 443,
      "OriginProto": "tcp",
      "OriginTcpRtt": 100000,
      "OriginTlsCipher": "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256",
      "OriginTlsFingerprint": "tls-fingerprint",
      "OriginTlsMode": "unknown",
      "OriginTlsProtocol": "SSLv3",
      "OriginTlsStatus": "KEYLESS_RPC",
      "ProxyProtocol": "simple",
      "Status": 123,
      "Timestamp": 1600368586194526741
  }
result: |
  {
      "Application": "app-123",
      "ClientASN": 123,
      "ClientBytes": 1024,
      "ClientCountry": "Greece",
      "ClientIP": "127.127.127.127",
      "ClientMatchedIpFirewall": "ALLOW",
      "ClientPort": 1040,
      "ClientProto": "tcp",
      "ClientTcpRtt": 200000,
      "ClientTlsCipher": "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256",
      "ClientTlsClientHelloServerName": "hello-server-name",
      "ClientTlsProtocol": "TLS 1.3",
      "ClientTlsStatus": "OK",
      "ColoCode": "IATA-123",
      "ConnectTimestamp": "2020-08-07T07:52:09Z",
      "DisconnectTimestamp": "2020-08-07T07:52:09Z",
      "Event": "connect",
      "IpFirewall": true,
      "OriginBytes": 512,
      "OriginIP": "128.128.128.128",
      "OriginPort": 443,
      "OriginProto": "tcp",
      "OriginTcpRtt": 100000,
      "OriginTlsCipher": "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256",
      "OriginTlsFingerprint": "tls-fingerprint",
      "OriginTlsMode": "unknown",
      "OriginTlsProtocol": "SSLv3",
      "OriginTlsStatus": "KEYLESS_RPC",
      "ProxyProtocol": "simple",
      "Status": 123,
      "Timestamp": "2020-09-17T18:49:46Z",

  	"p_log_type": "Cloudflare.Spectrum",
  	"p_event_time":"2020-09-17T18:49:46.194526741Z",
  	"p_any_ip_addresses": ["127.127.127.127", "128.128.128.128"]
  }

---
name: spectrum required fields only
logType: Cloudflare.Spectrum
input: |
  {
    "Timestamp": "2020-09-17T18:00:00Z"
  }
result: |
  {
    "Timestamp": "2020-09-17T18:00:00Z",
    "p_log_type": "Cloudflare.Spectrum",
    "p_event_time":"2020-09-17T18:00:00Z"
  }
